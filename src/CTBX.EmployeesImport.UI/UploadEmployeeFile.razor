@page "/file-upload"
@inject ISnackbar Snackbar
@inject UploadEmployeesService Service

<MudPaper Class="d-flex flex-column align-center py-4">
    <MudText Typo="Typo.h4" GutterBottom="true">Employee File Upload</MudText>
    <MudText Typo="Typo.body1" Class="mb-4 text-center">
        Please upload a CSV or TXT file to import your employees into the database.
        Maximum 10 at once per upload.
        Supported formats: <strong>.csv</strong>, <strong>.txt</strong>. Each file must follow the required format.
    </MudText>

    <MudFileUpload
        T="IReadOnlyList<IBrowserFile>"
        FilesChanged="UploadFiles">
        <ActivatorContent>
    <MudButton
        Variant="Variant.Filled"
        Color="Color.Success"
        StartIcon="@Icons.Material.Filled.UploadFile">
        Upload Files
        </MudButton>
        </ActivatorContent>
    </MudFileUpload>
</MudPaper>


@code {
    public string Error { get; set; } = string.Empty;
    public int MaxFiles = 10;
    
    private async Task UploadFiles(IReadOnlyList<IBrowserFile> files)
    {
        byte[] content = [];
        foreach (var file in files)
        {
            // _fileDataList.Add(new()
            //  {
            //      FileName = file.Name,
            //      FileSize = file.Size,
            //      FileType = file.ContentType,
            //      Content = content
            //  });
            try
            {
                await Service.SaveFileToFolder(file, @"C: \Users\User\Desktop\CompanyToolbox\src\CTBX.EmployeesImport.Shared\FilePaths\");
                Snackbar.Add("Files Uploaded",Severity.Success);
            }
            catch (Exception ex)
            {

                Snackbar.Add(ex.Message, Severity.Error);
            }
            
        }

        // Todo [AL] move to submit button
        // await Service.UploadFiles(_fileDataList.ToImmutableList(), CancellationToken.None);

        
    }



}